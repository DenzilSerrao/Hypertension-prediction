#!/bin/bash

# Create a sample dataset if it doesn't exist
if [ ! -f "./backend/training/personalized_medication_dataset.csv" ]; then
  echo "Creating sample dataset..."
  mkdir -p ./backend/training
  echo "Age,Gender,Weight_kg,Height_cm,BMI,Genetic_Disorders,Chronic_Conditions" > ./backend/training/personalized_medication_dataset.csv
  # Sample data will be generated by the Python script
fi

# Check if model exists, train if not
if [ ! -f "./backend/model/saved_model.pkl" ]; then
  echo "Training model..."
  cd ./backend/training
  python model_training.py
  cd ../..
fi

# Start the backend server
echo "Starting Flask backend..."
cd ./backend
python app.py &
BACKEND_PID=$!
cd ..

# Start the frontend
echo "Starting React frontend..."
npm run dev

# Clean up when frontend is stopped
kill $BACKEND_PID